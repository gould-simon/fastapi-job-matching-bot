{"timestamp": "2025-02-05T23:27:11.132286", "level": "INFO", "name": "bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 38}
{"timestamp": "2025-02-05T23:27:33.631241", "level": "INFO", "name": "bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 38}
{"timestamp": "2025-02-05T23:28:03.223779", "level": "INFO", "name": "bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 38}
{"timestamp": "2025-02-05T23:28:03.314975", "level": "INFO", "name": "bot", "message": "Start command received", "taskName": "Task-3", "user": {"telegram_id": 11111, "username": "test_user_1", "first_name": "Test", "last_name": "User"}, "error_context": {}, "file": "telegram_bot.py", "line": 408}
{"timestamp": "2025-02-05T23:28:10.867471", "level": "INFO", "name": "db", "message": "New database connection established", "taskName": "Task-3", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 83}
{"timestamp": "2025-02-05T23:28:10.867650", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-3", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:28:14.460226", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-4", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:28:14.460389", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-4", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:28:14.491221", "level": "ERROR", "name": "bot", "message": "Error occurred: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 425, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-3", "error_context": {"error_type": "ProgrammingError", "error_message": "(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "traceback": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 425, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)\n", "context": {"command": "start", "user_id": 11111, "username": "test_user_1"}}, "file": "logging_config.py", "line": 112, "exc_type": "ProgrammingError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 46, in test_start_command\n    await start_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 439, in start_command\n    log_error(bot_logger, e, context={\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 112, in log_error\n    logger.error(\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:28:14.561855", "level": "INFO", "name": "bot", "message": "CV upload initiated", "taskName": "Task-11", "user": {"telegram_id": 22222, "username": "test_user"}, "error_context": {}, "file": "telegram_bot.py", "line": 467}
{"timestamp": "2025-02-05T23:28:14.562860", "level": "ERROR", "name": "bot", "message": "Error occurred: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 500, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "taskName": "Task-11", "error_context": {"error_type": "FileNotFoundError", "error_message": "[Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "traceback": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 500, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'\n", "context": {"command": "upload_cv", "user_id": 22222, "username": "test_user", "file_name": "test_cv.pdf"}}, "file": "logging_config.py", "line": 112, "exc_type": "FileNotFoundError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 102, in test_upload_cv_command\n    await upload_cv_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 529, in upload_cv_command\n    log_error(bot_logger, e, context={\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 112, in log_error\n    logger.error(\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:28:14.581639", "level": "DEBUG", "name": "db", "message": "Database session created", "taskName": "Task-17", "error_context": {}, "file": "database.py", "line": 128}
{"timestamp": "2025-02-05T23:28:15.767266", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-17", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:28:17.151792", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-21", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:28:17.151908", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-21", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:28:17.151972", "level": "DEBUG", "name": "db", "message": "Session closed", "taskName": "Task-21", "error_context": {}, "file": "database.py", "line": 141}
{"timestamp": "2025-02-05T23:28:18.050267", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-26", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:28:18.942372", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-27", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:28:18.942882", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-27", "connection_id": 4406125504, "pool_id": 4405913040, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:29:26.071616", "level": "INFO", "name": "app.telegram_bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 38}
{"timestamp": "2025-02-05T23:29:26.162805", "level": "INFO", "name": "app.telegram_bot", "message": "Start command received", "taskName": "Task-3", "user": {"telegram_id": 11111, "username": "test_user_1", "first_name": "Test", "last_name": "User"}, "error_context": {}, "file": "telegram_bot.py", "line": 408}
{"timestamp": "2025-02-05T23:29:32.899760", "level": "INFO", "name": "db", "message": "New database connection established", "taskName": "Task-3", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 83}
{"timestamp": "2025-02-05T23:29:32.899985", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-3", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:29:36.497955", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-4", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:29:36.498111", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-4", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:29:36.525476", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in start_command: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 425, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-3", "error_context": {}, "file": "telegram_bot.py", "line": 439, "exc_type": "ProgrammingError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 46, in test_start_command\n    await start_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 439, in start_command\n    logger.error(f\"Error in start_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:29:36.600304", "level": "INFO", "name": "app.telegram_bot", "message": "CV upload initiated", "taskName": "Task-11", "user": {"telegram_id": 22222, "username": "test_user"}, "error_context": {}, "file": "telegram_bot.py", "line": 463}
{"timestamp": "2025-02-05T23:29:36.601137", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in upload_cv_command: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 496, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "taskName": "Task-11", "error_context": {}, "file": "telegram_bot.py", "line": 525, "exc_type": "FileNotFoundError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 102, in test_upload_cv_command\n    await upload_cv_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 525, in upload_cv_command\n    logger.error(f\"Error in upload_cv_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:29:36.619479", "level": "DEBUG", "name": "db", "message": "Database session created", "taskName": "Task-17", "error_context": {}, "file": "database.py", "line": 128}
{"timestamp": "2025-02-05T23:29:37.804114", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-17", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:29:39.020439", "level": "ERROR", "name": "app.telegram_bot", "message": "Error searching jobs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column \"telegram_id\" of relation \"user_searches\" does not exist\n[SQL: INSERT INTO user_searches (telegram_id, search_query, structured_preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR) RETURNING user_searches.id, user_searches.created_at]\n[parameters: (<AsyncMock name='mock.message.from_user.id' id='5379321072'>, '/search_jobs audit jobs', None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-17", "error_context": {}, "file": "telegram_bot.py", "line": 573, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 133, in test_search_jobs_command\n    await search_jobs_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 573, in search_jobs_command\n    logger.error(f\"Error searching jobs: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:29:39.057188", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-19", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:29:39.059017", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-19", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:29:39.059875", "level": "DEBUG", "name": "db", "message": "Session closed", "taskName": "Task-19", "error_context": {}, "file": "database.py", "line": 141}
{"timestamp": "2025-02-05T23:29:40.124975", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-26", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:29:41.044929", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-27", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:29:41.045026", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-27", "connection_id": 4961338560, "pool_id": 4961080944, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:29:41.045602", "level": "ERROR", "name": "app.telegram_bot", "message": "Error setting preferences: No row was found when one was required", "taskName": "Task-26", "error_context": {}, "file": "telegram_bot.py", "line": 613, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 158, in test_set_preferences_command\n    await set_preferences_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 613, in set_preferences_command\n    logger.error(f\"Error setting preferences: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:31:14.635639", "level": "INFO", "name": "app.telegram_bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 38}
{"timestamp": "2025-02-05T23:31:27.029150", "level": "INFO", "name": "app.telegram_bot", "message": "Start command received", "taskName": "Task-104", "user": {"telegram_id": 11111, "username": "test_user_1", "first_name": "Test", "last_name": "User"}, "error_context": {}, "file": "telegram_bot.py", "line": 408}
{"timestamp": "2025-02-05T23:31:33.740743", "level": "INFO", "name": "db", "message": "New database connection established", "taskName": "Task-104", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 83}
{"timestamp": "2025-02-05T23:31:33.740923", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-104", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:31:37.336254", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-105", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:31:37.336360", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-105", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:31:37.353131", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in start_command: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 425, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR) RETURNING users.id, users.created_at, users.updated_at, users.last_active]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-104", "error_context": {}, "file": "telegram_bot.py", "line": 439, "exc_type": "ProgrammingError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 48, in test_start_command\n    await start_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 439, in start_command\n    logger.error(f\"Error in start_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:31:37.402556", "level": "INFO", "name": "app.telegram_bot", "message": "CV upload initiated", "taskName": "Task-112", "user": {"telegram_id": 22222, "username": "test_user"}, "error_context": {}, "file": "telegram_bot.py", "line": 463}
{"timestamp": "2025-02-05T23:31:37.403455", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in upload_cv_command: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 496, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "taskName": "Task-112", "error_context": {}, "file": "telegram_bot.py", "line": 525, "exc_type": "FileNotFoundError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 104, in test_upload_cv_command\n    await upload_cv_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 525, in upload_cv_command\n    logger.error(f\"Error in upload_cv_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:31:38.611953", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-118", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:31:39.812219", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-119", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:31:39.812354", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-119", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:31:39.813064", "level": "ERROR", "name": "app.telegram_bot", "message": "Error searching jobs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column \"telegram_id\" of relation \"user_searches\" does not exist\n[SQL: INSERT INTO user_searches (telegram_id, search_query, structured_preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR) RETURNING user_searches.id, user_searches.created_at]\n[parameters: (123456789, 'audit jobs', None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-118", "error_context": {}, "file": "telegram_bot.py", "line": 567, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 134, in test_search_jobs_command\n    await search_jobs_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 567, in search_jobs_command\n    logger.error(f\"Error searching jobs: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:31:40.765700", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-125", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:31:41.661719", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-126", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:31:41.661802", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-126", "connection_id": 4948258752, "pool_id": 4948676240, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:31:41.662287", "level": "ERROR", "name": "app.telegram_bot", "message": "Error setting preferences: No row was found when one was required", "taskName": "Task-125", "error_context": {}, "file": "telegram_bot.py", "line": 607, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 168, in test_set_preferences_command\n    await set_preferences_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 607, in set_preferences_command\n    logger.error(f\"Error setting preferences: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:32:57.762933", "level": "INFO", "name": "app.telegram_bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 39}
{"timestamp": "2025-02-05T23:32:57.852310", "level": "INFO", "name": "app.telegram_bot", "message": "Start command received", "taskName": "Task-3", "user": {"telegram_id": 11111, "username": "test_user_1", "first_name": "Test", "last_name": "User"}, "error_context": {}, "file": "telegram_bot.py", "line": 409}
{"timestamp": "2025-02-05T23:33:04.669321", "level": "INFO", "name": "db", "message": "New database connection established", "taskName": "Task-3", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 83}
{"timestamp": "2025-02-05T23:33:04.670063", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-3", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:33:08.321390", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-4", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:33:08.321602", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-4", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:33:08.353100", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in start_command: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences, created_at, updated_at, last_active) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None, datetime.datetime(2025, 2, 5, 23, 33, 7, 412678), datetime.datetime(2025, 2, 5, 23, 33, 7, 412688), datetime.datetime(2025, 2, 5, 23, 33, 7, 412691))]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 426, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences, created_at, updated_at, last_active) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None, datetime.datetime(2025, 2, 5, 23, 33, 7, 412678), datetime.datetime(2025, 2, 5, 23, 33, 7, 412688), datetime.datetime(2025, 2, 5, 23, 33, 7, 412691))]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-3", "error_context": {}, "file": "telegram_bot.py", "line": 440, "exc_type": "ProgrammingError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 48, in test_start_command\n    await start_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 440, in start_command\n    logger.error(f\"Error in start_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:33:08.432778", "level": "INFO", "name": "app.telegram_bot", "message": "CV upload initiated", "taskName": "Task-11", "user": {"telegram_id": 22222, "username": "test_user"}, "error_context": {}, "file": "telegram_bot.py", "line": 464}
{"timestamp": "2025-02-05T23:33:08.433674", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in upload_cv_command: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 497, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "taskName": "Task-11", "error_context": {}, "file": "telegram_bot.py", "line": 526, "exc_type": "FileNotFoundError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 104, in test_upload_cv_command\n    await upload_cv_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 526, in upload_cv_command\n    logger.error(f\"Error in upload_cv_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:33:09.657094", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-17", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:33:10.873804", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-18", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:33:10.873914", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-18", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:33:10.874504", "level": "ERROR", "name": "app.telegram_bot", "message": "Error searching jobs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column \"telegram_id\" of relation \"user_searches\" does not exist\n[SQL: INSERT INTO user_searches (telegram_id, search_query, structured_preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR) RETURNING user_searches.id, user_searches.created_at]\n[parameters: (123456789, 'audit jobs', None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-17", "error_context": {}, "file": "telegram_bot.py", "line": 573, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 134, in test_search_jobs_command\n    await search_jobs_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 573, in search_jobs_command\n    logger.error(f\"Error searching jobs: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:33:11.855978", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-24", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:33:12.774114", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-25", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:33:12.774243", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-25", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:33:12.774872", "level": "ERROR", "name": "app.telegram_bot", "message": "User not found: 123456789", "taskName": "Task-24", "error_context": {}, "file": "telegram_bot.py", "line": 613, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 168, in test_set_preferences_command\n    await set_preferences_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 613, in set_preferences_command\n    logger.error(f\"User not found: {update.effective_user.id}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:33:13.714600", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-31", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:33:14.934777", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-32", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:33:14.934928", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-32", "connection_id": 4443802176, "pool_id": 4443626416, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:33:14.935748", "level": "ERROR", "name": "app.telegram_bot", "message": "Error searching jobs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column \"telegram_id\" of relation \"user_searches\" does not exist\n[SQL: INSERT INTO user_searches (telegram_id, search_query, structured_preferences) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR) RETURNING user_searches.id, user_searches.created_at]\n[parameters: (999999, 'audit jobs', None)]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-31", "error_context": {}, "file": "telegram_bot.py", "line": 573, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 199, in test_user_not_found\n    await search_jobs_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 573, in search_jobs_command\n    logger.error(f\"Error searching jobs: {str(e)}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:37.991703", "level": "INFO", "name": "app.telegram_bot", "message": "\ud83d\ude80 Starting bot in development environment using bot token: 75673047...", "taskName": null, "error_context": {}, "file": "telegram_bot.py", "line": 39}
{"timestamp": "2025-02-05T23:34:38.089845", "level": "INFO", "name": "app.telegram_bot", "message": "Start command received", "taskName": "Task-3", "user": {"telegram_id": 11111, "username": "test_user_1", "first_name": "Test", "last_name": "User"}, "error_context": {}, "file": "telegram_bot.py", "line": 409}
{"timestamp": "2025-02-05T23:34:44.798450", "level": "INFO", "name": "db", "message": "New database connection established", "taskName": "Task-3", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 83}
{"timestamp": "2025-02-05T23:34:44.798570", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-3", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:34:48.401633", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-4", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:34:48.401757", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-4", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:34:48.426343", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in start_command: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences, created_at, updated_at, last_active) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None, datetime.datetime(2025, 2, 5, 23, 34, 47, 505712), datetime.datetime(2025, 2, 5, 23, 34, 47, 505725), datetime.datetime(2025, 2, 5, 23, 34, 47, 505728))]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DatatypeMismatchError: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 426, in start_command\n    await session.commit()\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1011, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2032, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4353, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4488, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4449, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column \"cv_embedding\" is of type double precision[] but expression is of type character varying\nHINT:  You will need to rewrite or cast the expression.\n[SQL: INSERT INTO users (telegram_id, username, first_name, last_name, cv_text, cv_embedding, preferences, created_at, updated_at, last_active) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::TIMESTAMP WITHOUT TIME ZONE) RETURNING users.id]\n[parameters: (11111, 'test_user_1', 'Test', 'User', None, None, None, datetime.datetime(2025, 2, 5, 23, 34, 47, 505712), datetime.datetime(2025, 2, 5, 23, 34, 47, 505725), datetime.datetime(2025, 2, 5, 23, 34, 47, 505728))]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Task-3", "error_context": {}, "file": "telegram_bot.py", "line": 440, "exc_type": "ProgrammingError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 48, in test_start_command\n    await start_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 440, in start_command\n    logger.error(f\"Error in start_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:48.499760", "level": "INFO", "name": "app.telegram_bot", "message": "CV upload initiated", "taskName": "Task-11", "user": {"telegram_id": 22222, "username": "test_user"}, "error_context": {}, "file": "telegram_bot.py", "line": 464}
{"timestamp": "2025-02-05T23:34:48.500699", "level": "ERROR", "name": "app.telegram_bot", "message": "Error in upload_cv_command: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 497, in upload_cv_command\n    'file_size': os.path.getsize(file_path)\n                 ~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"<frozen genericpath>\", line 86, in getsize\nFileNotFoundError: [Errno 2] No such file or directory: 'temp/22222_test_cv.pdf'", "taskName": "Task-11", "error_context": {}, "file": "telegram_bot.py", "line": 526, "exc_type": "FileNotFoundError", "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 104, in test_upload_cv_command\n    await upload_cv_command(mock_update, mock_context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 526, in upload_cv_command\n    logger.error(f\"Error in upload_cv_command: {str(e)}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:49.713112", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-17", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:34:50.309760", "level": "ERROR", "name": "app.telegram_bot", "message": "User not found: 123456789", "taskName": "Task-17", "error_context": {}, "file": "telegram_bot.py", "line": 553, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 134, in test_search_jobs_command\n    await search_jobs_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 553, in search_jobs_command\n    logger.error(f\"User not found: {update.effective_user.id}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:50.609080", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-18", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:34:50.609169", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-18", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:34:51.565256", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-24", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:34:52.341242", "level": "ERROR", "name": "app.telegram_bot", "message": "User not found: 123456789", "taskName": "Task-24", "error_context": {}, "file": "telegram_bot.py", "line": 610, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 168, in test_set_preferences_command\n    await set_preferences_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 610, in set_preferences_command\n    logger.error(f\"User not found: {update.effective_user.id}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:52.641029", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-25", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:34:52.641153", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-25", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:34:53.559455", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-31", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:34:54.155202", "level": "ERROR", "name": "app.telegram_bot", "message": "User not found: 999999", "taskName": "Task-31", "error_context": {}, "file": "telegram_bot.py", "line": 553, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 199, in test_user_not_found\n    await search_jobs_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 553, in search_jobs_command\n    logger.error(f\"User not found: {update.effective_user.id}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:54.458251", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-32", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:34:54.458377", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-32", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 97}
{"timestamp": "2025-02-05T23:34:55.375705", "level": "DEBUG", "name": "db", "message": "Database connection checked out from pool", "taskName": "Task-38", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 90}
{"timestamp": "2025-02-05T23:34:55.973865", "level": "ERROR", "name": "app.telegram_bot", "message": "User not found: 123456789", "taskName": "Task-38", "error_context": {}, "file": "telegram_bot.py", "line": 610, "stack_trace": ["  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/bin/pytest\", line 8, in <module>\n    sys.exit(console_main())\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 197, in console_main\n    code = main()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/config/__init__.py\", line 174, in main\n    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 319, in pytest_cmdline_main\n    return wrap_session(config, _main)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 272, in wrap_session\n    session.exitstatus = doit(config, session) or 0\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 326, in _main\n    config.hook.pytest_runtestloop(session=session)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/main.py\", line 351, in pytest_runtestloop\n    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\n    runtestprotocol(item, nextitem=nextitem)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\n    reports.append(call_and_report(item, \"call\", log))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 226, in call_and_report\n    call = call_runtest_hook(item, when, **kwds)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 265, in call_runtest_hook\n    return CallInfo.from_call(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 345, in from_call\n    result: Optional[TResult] = func()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    item.runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 440, in runtest\n    super().runtest()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 1836, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py\", line 907, in inner\n    _loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/tests/test_telegram_bot.py\", line 225, in test_invalid_preferences_format\n    await set_preferences_command(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 610, in set_preferences_command\n    logger.error(f\"User not found: {update.effective_user.id}\")\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 39, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"timestamp": "2025-02-05T23:34:56.273140", "level": "INFO", "name": "db", "message": "Database connection reset", "taskName": "Task-39", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 104}
{"timestamp": "2025-02-05T23:34:56.273278", "level": "DEBUG", "name": "db", "message": "Database connection returned to pool", "taskName": "Task-39", "connection_id": 4535897536, "pool_id": 4535705168, "error_context": {}, "file": "database.py", "line": 97}
