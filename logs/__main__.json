{"message": "Logger configured", "taskName": null, "logger_name": "__main__", "handlers": ["console", "file"], "environment": "production", "timestamp": "2025-02-06T00:17:41.825343", "level": "INFO", "is_test": false, "file": "logging_config.py", "line": 84, "function": "get_logger"}
{"message": "\ud83d\ude80 Starting bot in production environment using bot token: 75673047...", "taskName": null, "timestamp": "2025-02-06T00:17:41.825422", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 40, "function": "<module>"}
{"message": "Starting bot initialization...", "taskName": "Task-1", "timestamp": "2025-02-06T00:17:41.850965", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 682, "function": "main"}
{"message": "Using token: 75673...", "taskName": "Task-1", "timestamp": "2025-02-06T00:17:41.851009", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 683, "function": "main"}
{"message": "Handlers registered successfully", "taskName": "Task-1", "timestamp": "2025-02-06T00:17:41.851146", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 708, "function": "main"}
{"message": "\ud83e\udd16 Bot is now polling for messages...", "taskName": "Task-1", "timestamp": "2025-02-06T00:17:41.851186", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 711, "function": "main"}
{"message": "Bot is running. Press Ctrl+C to stop", "taskName": "Task-1", "timestamp": "2025-02-06T00:17:41.976494", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 718, "function": "main"}
{"message": "Start command received from user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:17:48.801252", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 55, "function": "start"}
{"message": "Welcome message sent to user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:17:48.943047", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 67, "function": "start"}
{"message": "Checking if user exists in database...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:17:48.943806", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 73, "function": "start"}
{"message": "Creating new user...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:17:58.595744", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 82, "function": "start"}
{"message": "New user registered: 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:17:59.535414", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 91, "function": "start"}
{"message": "Starting job preference processing for user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.129610", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 138, "function": "process_job_preferences"}
{"message": "Processing job preferences for user 6136408822: audit manager roles in new york", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.132024", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 139, "function": "process_job_preferences"}
{"message": "Calling extract_job_preferences", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.132397", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 143, "function": "process_job_preferences"}
{"message": "Extracted preferences: {'role': 'audit manager', 'location': 'new york', 'experience': 'manager', 'salary': None, 'search_type': 'job_title'}", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.935936", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 154, "function": "process_job_preferences"}
{"message": "Checking database state before search...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.936398", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 169, "function": "process_job_preferences"}
{"message": "Error in semantic search: NameError - name 'Job' is not defined", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 170, in process_job_preferences\n    jobs_count = await db.scalar(select(func.count()).select_from(Job))\n                                                                  ^^^\nNameError: name 'Job' is not defined", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:18:05.947075", "level": "ERROR", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 247, "function": "process_job_preferences", "exc_type": "NameError", "stack_trace": ["  File \"<frozen runpy>\", line 198, in _run_module_as_main\n", "  File \"<frozen runpy>\", line 88, in _run_code\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 735, in <module>\n    asyncio.run(main())\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 194, in run\n    return runner.run(main)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 118, in run\n    return self._loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1248, in _update_fetcher\n    await self.__update_fetcher()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1244, in __update_fetcher\n    await self.__process_update_wrapper(update)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1259, in __process_update_wrapper\n    await self._update_processor.process_update(update, self.process_update(update))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 157, in process_update\n    await self.do_process_update(update, coroutine)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 182, in do_process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1325, in process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/conversationhandler.py\", line 842, in handle_update\n    new_state: object = await handler.handle_update(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/basehandler.py\", line 158, in handle_update\n    return await self.callback(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 247, in process_job_preferences\n    logger.error(f\"Error in semantic search: {error_type} - {error_msg}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 44, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"message": "Bot stopped by user", "taskName": null, "timestamp": "2025-02-06T00:19:14.498821", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 737, "function": "<module>"}
{"message": "Logger configured", "taskName": null, "logger_name": "__main__", "handlers": ["console", "file"], "environment": "production", "timestamp": "2025-02-06T00:19:16.130416", "level": "INFO", "is_test": false, "file": "logging_config.py", "line": 84, "function": "get_logger"}
{"message": "\ud83d\ude80 Starting bot in production environment using bot token: 75673047...", "taskName": null, "timestamp": "2025-02-06T00:19:16.130488", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 40, "function": "<module>"}
{"message": "Starting bot initialization...", "taskName": "Task-1", "timestamp": "2025-02-06T00:19:16.156271", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 682, "function": "main"}
{"message": "Using token: 75673...", "taskName": "Task-1", "timestamp": "2025-02-06T00:19:16.156314", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 683, "function": "main"}
{"message": "Handlers registered successfully", "taskName": "Task-1", "timestamp": "2025-02-06T00:19:16.156447", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 708, "function": "main"}
{"message": "\ud83e\udd16 Bot is now polling for messages...", "taskName": "Task-1", "timestamp": "2025-02-06T00:19:16.156487", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 711, "function": "main"}
{"message": "Bot is running. Press Ctrl+C to stop", "taskName": "Task-1", "timestamp": "2025-02-06T00:19:16.265769", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 718, "function": "main"}
{"message": "Start command received from user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:22.977282", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 55, "function": "start"}
{"message": "Welcome message sent to user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:23.167530", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 67, "function": "start"}
{"message": "Checking if user exists in database...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:23.167915", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 73, "function": "start"}
{"message": "Starting job preference processing for user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:37.949241", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 138, "function": "process_job_preferences"}
{"message": "Processing job preferences for user 6136408822: audit manager roles in New York", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:37.949382", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 139, "function": "process_job_preferences"}
{"message": "Calling extract_job_preferences", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:37.949440", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 143, "function": "process_job_preferences"}
{"message": "Extracted preferences: {'role': 'audit manager', 'location': 'new york', 'experience': 'manager', 'salary': None, 'search_type': 'job_title'}", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:38.944760", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 154, "function": "process_job_preferences"}
{"message": "Checking database state before search...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:38.945177", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 169, "function": "process_job_preferences"}
{"message": "Error in semantic search: NameError - name 'JobEmbedding' is not defined", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 171, in process_job_preferences\n    embeddings_count = await db.scalar(select(func.count()).select_from(JobEmbedding))\n                                                                        ^^^^^^^^^^^^\nNameError: name 'JobEmbedding' is not defined", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:19:41.105948", "level": "ERROR", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 247, "function": "process_job_preferences", "exc_type": "NameError", "stack_trace": ["  File \"<frozen runpy>\", line 198, in _run_module_as_main\n", "  File \"<frozen runpy>\", line 88, in _run_code\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 735, in <module>\n    asyncio.run(main())\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 194, in run\n    return runner.run(main)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 118, in run\n    return self._loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1248, in _update_fetcher\n    await self.__update_fetcher()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1244, in __update_fetcher\n    await self.__process_update_wrapper(update)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1259, in __process_update_wrapper\n    await self._update_processor.process_update(update, self.process_update(update))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 157, in process_update\n    await self.do_process_update(update, coroutine)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 182, in do_process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1325, in process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/conversationhandler.py\", line 842, in handle_update\n    new_state: object = await handler.handle_update(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/basehandler.py\", line 158, in handle_update\n    return await self.callback(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 247, in process_job_preferences\n    logger.error(f\"Error in semantic search: {error_type} - {error_msg}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 44, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
{"message": "Bot stopped by user", "taskName": null, "timestamp": "2025-02-06T00:20:33.008892", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 737, "function": "<module>"}
{"message": "Logger configured", "taskName": null, "logger_name": "__main__", "handlers": ["console", "file"], "environment": "production", "timestamp": "2025-02-06T00:20:34.496027", "level": "INFO", "is_test": false, "file": "logging_config.py", "line": 84, "function": "get_logger"}
{"message": "\ud83d\ude80 Starting bot in production environment using bot token: 75673047...", "taskName": null, "timestamp": "2025-02-06T00:20:34.496089", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 40, "function": "<module>"}
{"message": "Starting bot initialization...", "taskName": "Task-1", "timestamp": "2025-02-06T00:20:34.522182", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 682, "function": "main"}
{"message": "Using token: 75673...", "taskName": "Task-1", "timestamp": "2025-02-06T00:20:34.522225", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 683, "function": "main"}
{"message": "Handlers registered successfully", "taskName": "Task-1", "timestamp": "2025-02-06T00:20:34.522360", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 708, "function": "main"}
{"message": "\ud83e\udd16 Bot is now polling for messages...", "taskName": "Task-1", "timestamp": "2025-02-06T00:20:34.522399", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 711, "function": "main"}
{"message": "Bot is running. Press Ctrl+C to stop", "taskName": "Task-1", "timestamp": "2025-02-06T00:20:34.628752", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 718, "function": "main"}
{"message": "Start command received from user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:38.594919", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 55, "function": "start"}
{"message": "Welcome message sent to user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:38.678457", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 67, "function": "start"}
{"message": "Checking if user exists in database...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:38.678785", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 73, "function": "start"}
{"message": "Starting job preference processing for user 6136408822", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:49.497999", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 138, "function": "process_job_preferences"}
{"message": "Processing job preferences for user 6136408822: audit manager roles in new york", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:49.498184", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 139, "function": "process_job_preferences"}
{"message": "Calling extract_job_preferences", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:49.498290", "level": "DEBUG", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 143, "function": "process_job_preferences"}
{"message": "Extracted preferences: {'role': 'audit manager', 'location': 'new york', 'experience': 'manager', 'salary': None, 'search_type': 'job_title'}", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:50.402462", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 154, "function": "process_job_preferences"}
{"message": "Checking database state before search...", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:50.402707", "level": "INFO", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 169, "function": "process_job_preferences"}
{"message": "Error in semantic search: ProgrammingError - (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation \"job_embeddings\" does not exist\n[SQL: SELECT count(*) AS count_1 \nFROM job_embeddings]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 521, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 768, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.UndefinedTableError: relation \"job_embeddings\" does not exist\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation \"job_embeddings\" does not exist\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 171, in process_job_preferences\n    embeddings_count = await db.scalar(select(func.count()).select_from(JobEmbedding))\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 519, in scalar\n    return await greenlet_spawn(\n           ^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 201, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2413, in scalar\n    return self._execute_internal(\n           ~~~~~~~~~~~~~~~~~~~~~~^\n        statement,\n        ^^^^^^^^^^\n    ...<4 lines>...\n        **kw,\n        ^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2251, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self,\n        ^^^^^\n    ...<4 lines>...\n        conn,\n        ^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n        statement, params or {}, execution_options=execution_options\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1638, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1843, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1983, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2352, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1964, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 942, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 508, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 792, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation \"job_embeddings\" does not exist\n[SQL: SELECT count(*) AS count_1 \nFROM job_embeddings]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "taskName": "Application:7567304791:update_fetcher", "timestamp": "2025-02-06T00:20:53.148994", "level": "ERROR", "environment": "production", "is_test": false, "file": "telegram_bot.py", "line": 247, "function": "process_job_preferences", "exc_type": "ProgrammingError", "stack_trace": ["  File \"<frozen runpy>\", line 198, in _run_module_as_main\n", "  File \"<frozen runpy>\", line 88, in _run_code\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 735, in <module>\n    asyncio.run(main())\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 194, in run\n    return runner.run(main)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py\", line 118, in run\n    return self._loop.run_until_complete(task)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 707, in run_until_complete\n    self.run_forever()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 678, in run_forever\n    self._run_once()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py\", line 2033, in _run_once\n    handle._run()\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py\", line 89, in _run\n    self._context.run(self._callback, *self._args)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1248, in _update_fetcher\n    await self.__update_fetcher()\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1244, in __update_fetcher\n    await self.__process_update_wrapper(update)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1259, in __process_update_wrapper\n    await self._update_processor.process_update(update, self.process_update(update))\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 157, in process_update\n    await self.do_process_update(update, coroutine)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_baseupdateprocessor.py\", line 182, in do_process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_application.py\", line 1325, in process_update\n    await coroutine\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/conversationhandler.py\", line 842, in handle_update\n    new_state: object = await handler.handle_update(\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/telegram/ext/_handlers/basehandler.py\", line 158, in handle_update\n    return await self.callback(update, context)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/telegram_bot.py\", line 247, in process_job_preferences\n    logger.error(f\"Error in semantic search: {error_type} - {error_msg}\", exc_info=True)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1548, in error\n    self._log(ERROR, msg, args, **kwargs)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1664, in _log\n    self.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1680, in handle\n    self.callHandlers(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1736, in callHandlers\n    hdlr.handle(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1026, in handle\n    self.emit(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/handlers.py\", line 81, in emit\n    logging.FileHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1264, in emit\n    StreamHandler.emit(self, record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 1150, in emit\n    msg = self.format(record)\n", "  File \"/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/logging/__init__.py\", line 998, in format\n    return fmt.format(record)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/venv/lib/python3.13/site-packages/pythonjsonlogger/jsonlogger.py\", line 243, in format\n    self.add_fields(log_record, record, message_dict)\n", "  File \"/Users/dudleygould/fastapi-job-matching-bot/app/logging_config.py\", line 44, in add_fields\n    log_record['stack_trace'] = traceback.format_stack()\n"]}
